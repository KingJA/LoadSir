![](imgs/LoadSir.jpg)

ä¸­æ–‡ | [English](README-en.md)

LoadSir
---

[![](https://img.shields.io/badge/%20%20Android%20Arsenal%20%20-%20%20LoadSir%20%20-blue.svg)](https://android-arsenal.com/details/1/6227)
[![](https://img.shields.io/badge/%20%20aar%20size-26KB-green.svg)](https://bintray.com/kingja/maven/loadsir#files/com%2Fkingja%2Floadsir%2Floadsir%2F1.2.0)
:point_right:[![](https://img.shields.io/github/release/KingJA/LoadSir.svg)](https://github.com/KingJA/LoadSir/releases):point_left:

`LoadSir`æ˜¯ä¸€ä¸ªé«˜æ•ˆæ˜“ç”¨ï¼Œä½ç¢³ç¯ä¿ï¼Œæ‰©å±•æ€§è‰¯å¥½çš„åŠ è½½åé¦ˆé¡µç®¡ç†æ¡†æ¶ï¼Œåœ¨åŠ è½½ç½‘ç»œæˆ–å…¶ä»–æ•°æ®æ—¶å€™ï¼Œæ ¹æ®éœ€æ±‚åˆ‡æ¢çŠ¶æ€é¡µé¢ï¼Œ
å¯æ·»åŠ è‡ªå®šä¹‰çŠ¶æ€é¡µé¢ï¼Œå¦‚åŠ è½½ä¸­ï¼ŒåŠ è½½å¤±è´¥ï¼Œæ— æ•°æ®ï¼Œç½‘ç»œè¶…æ—¶ï¼Œå¦‚å ä½å›¾ï¼Œç™»å½•å¤±æ•ˆç­‰å¸¸ç”¨é¡µé¢ã€‚å¯é…åˆç½‘ç»œåŠ è½½æ¡†æ¶ï¼Œç»“åˆè¿”å›
çŠ¶æ€ç ï¼Œé”™è¯¯ç ï¼Œæ•°æ®è¿›è¡ŒçŠ¶æ€é¡µè‡ªåŠ¨åˆ‡æ¢ï¼Œå°è£…ä½¿ç”¨æ•ˆæœæ›´ä½³ã€‚

ä½¿ç”¨åœºæ™¯
---
| **in Activity**|**in View**|**in Fragment**|
|:---:|:----:|:----:|
|![](imgs/normal_activity.gif)|![](imgs/view_activity.gif)|![](imgs/single_fragment.gif)|

| **Placeholder**|**Muitl-Fragment**|**ViewPage+Fragment**|
|:---:|:----:|:----:|
|![](imgs/placeholder_activity.gif)|![](imgs/muitl_fragment.gif)|![](imgs/viewpage_fragment.gif)|

ä¸‹è½½ Demo
---
![](imgs/qcode_1.3.8.png)
###### (å¯†ç ï¼š9517)

æµç¨‹å›¾
---
<div align="center"><img src="imgs/LoadSir_flow.jpg"/></div>

LoadSirçš„åŠŸèƒ½åŠç‰¹ç‚¹
---
* :star:æ”¯æŒActivityï¼ŒFragmentï¼ŒFragment(v4)ï¼ŒViewçŠ¶æ€å›è°ƒ
* :star:é€‚é…å¤šä¸ªFragmentåˆ‡æ¢ï¼ŒåŠFragment+ViewPageråˆ‡æ¢ï¼Œä¸ä¼šå¸ƒå±€å åŠ æˆ–è€…å¸ƒå±€é”™ä¹±
* :star:åˆ©ç”¨æ³›å‹è½¬æ¢è¾“å…¥ä¿¡å·å’Œè¾“å‡ºçŠ¶æ€ï¼Œå¯æ ¹æ®ç½‘ç»œè¿”å›ä½“çš„çŠ¶æ€ç æˆ–è€…æ•°æ®è¿”å›è‡ªåŠ¨é€‚é…çŠ¶æ€é¡µï¼Œå®ç°å…¨å±€è‡ªåŠ¨çŠ¶æ€åˆ‡æ¢
* :star:æ— éœ€ä¿®æ”¹å¸ƒå±€æ–‡ä»¶
* :star:åªåŠ è½½å”¯ä¸€ä¸€ä¸ªçŠ¶æ€è§†å›¾ï¼Œä¸ä¼šé¢„åŠ è½½å…¨éƒ¨è§†å›¾
* :star:ä¸éœ€è¦è®¾ç½®æšä¸¾æˆ–è€…å¸¸é‡çŠ¶æ€å€¼ï¼Œç›´æ¥ç”¨çŠ¶æ€é¡µç±»ç±»å‹(xxx.class)ä½œä¸ºçŠ¶æ€ç 
* :star:å¯å¯¹å•ä¸ªçŠ¶æ€é¡µå•ç‹¬è®¾ç½®ç‚¹å‡»äº‹ä»¶ï¼Œæ ¹æ®è¿”å›booleanå€¼è¦†ç›–æˆ–è€…ç»“åˆOnReloadListenerä½¿ç”¨ï¼Œå¦‚ç½‘ç»œé”™è¯¯å¯è·³è½¬è®¾ç½®é¡µ
* :star:æ— é¢„è®¾é¡µé¢ï¼Œä½è€¦åˆï¼Œå¼€å‘è€…éšå¿ƒé…ç½®
* :star:å¯ä¿ç•™æ ‡é¢˜æ (Toolbar,titile viewç­‰)
* å¯è®¾ç½®é‡æ–°åŠ è½½ç‚¹å‡»äº‹ä»¶(OnReloadListener)
* å¯è‡ªå®šä¹‰çŠ¶æ€é¡µ(ç»§æ‰¿Callbackç±»)
* å¯åœ¨å­çº¿ç¨‹ç›´æ¥åˆ‡æ¢çŠ¶æ€
* å¯è®¾ç½®åˆå§‹çŠ¶æ€é¡µ(å¸¸ç”¨è¿›åº¦é¡µä½œä¸ºåˆå§‹çŠ¶æ€)
* å¯æ‰©å±•çŠ¶æ€é¡µé¢ï¼Œåœ¨é…ç½®ä¸­æ·»åŠ è‡ªå®šä¹‰çŠ¶æ€é¡µ
* å¯å…¨å±€å•ä¾‹é…ç½®ï¼Œä¹Ÿå¯ä»¥å•ç‹¬é…ç½®



å¼€å§‹ä½¿ç”¨LoadSir
---

LoadSirçš„ä½¿ç”¨ï¼Œåªéœ€è¦ç®€å•çš„ä¸‰æ­¥

### æ·»åŠ ä¾èµ–

```groovy
compile 'com.kingja.loadsir:loadsir:1.3.8'
```

### ç¬¬ä¸€æ­¥ï¼šé…ç½®

###### å…¨å±€é…ç½®æ–¹å¼
å…¨å±€é…ç½®æ–¹å¼ï¼Œä½¿ç”¨çš„æ˜¯å•ä¾‹æ¨¡å¼ï¼Œå³è·å–çš„é…ç½®éƒ½æ˜¯ä¸€æ ·çš„ã€‚å¯åœ¨Applicationä¸­é…ç½®ï¼Œæ·»åŠ çŠ¶æ€é¡µï¼Œè®¾ç½®é»˜è®¤çŠ¶æ€é¡µ

```java
public class App extends Application {
    @Override
    public void onCreate() {
        super.onCreate();
        LoadSir.beginBuilder()
                .addCallback(new ErrorCallback())//æ·»åŠ å„ç§çŠ¶æ€é¡µ
                .addCallback(new EmptyCallback())
                .addCallback(new LoadingCallback())
                .addCallback(new TimeoutCallback())
                .addCallback(new CustomCallback())
                .setDefaultCallback(LoadingCallback.class)//è®¾ç½®é»˜è®¤çŠ¶æ€é¡µ
                .commit();
    }
}
```
###### å•ç‹¬é…ç½®æ–¹å¼
å¦‚æœä½ å³æƒ³ä¿ç•™å…¨å±€é…ç½®ï¼Œåˆæƒ³åœ¨æŸä¸ªç‰¹æ®Šé¡µé¢åŠ ç‚¹ä¸åŒçš„é…ç½®ï¼Œå¯é‡‡ç”¨è¯¥æ–¹å¼ã€‚

```java
LoadSir loadSir = new LoadSir.Builder()
                .addCallback(new LoadingCallback())
                .addCallback(new EmptyCallback())
                .addCallback(new ErrorCallback())
                .build();
        loadService = loadSir.register(this, new Callback.OnReloadListener() {
            @Override
            public void onReload(View v) {
                // é‡æ–°åŠ è½½é€»è¾‘
            }
        });
```
### ç¬¬äºŒæ­¥ï¼šæ³¨å†Œ

###### åœ¨Activityä¸­ä½¿ç”¨

```java
@Override
protected void onCreate(@Nullable Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_content);
    // Your can change the callback on sub thread directly.
    LoadService loadService = LoadSir.getDefault().register(this, new Callback.OnReloadListener() {
        @Override
        public void onReload(View v) {
            // é‡æ–°åŠ è½½é€»è¾‘
        }
    });
}}
```

###### åœ¨View ä¸­ä½¿ç”¨
```java
ImageView imageView = (ImageView) findViewById(R.id.iv_img);
LoadSir loadSir = new LoadSir.Builder()
        .addCallback(new TimeoutCallback())
        .setDefaultCallback(LoadingCallback.class)
        .build();
loadService = loadSir.register(imageView, new Callback.OnReloadListener() {
    @Override
    public void onReload(View v) {
        loadService.showCallback(LoadingCallback.class);
        // é‡æ–°åŠ è½½é€»è¾‘
    }
});
Ps:
[1]è¦æ³¨å†ŒRelativeLayoutæˆ–ConstraintLayoutçš„å­Viewï¼Œå¦‚æœè¯¥å­Viewè¢«å…¶å®ƒå­Viewçº¦æŸï¼Œå»ºè®®åœ¨å­Viewå¤–å±‚å†åŒ…ä¸€å±‚å¸ƒå±€ï¼Œå‚è€ƒ
acitivy_view.xmå’Œactivity_constraintlayout.xml
```
###### åœ¨Fragment ä¸­ä½¿ç”¨
ç”±äºFragmentæ·»åŠ åˆ°Activitiyæ–¹å¼å¤šæ ·ï¼Œæ¯”è¾ƒç‰¹åˆ«ï¼Œæ‰€ä»¥åœ¨Fragmentæ³¨å†Œæ–¹å¼ä¸åŒäºä¸Šé¢ä¸¤ç§ï¼Œå¤§å®¶å…ˆçœ‹æ¨¡æ¿ä»£ç ï¼š
```java
@Nullable
@Override
public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle
        savedInstanceState) {
    //ç¬¬ä¸€æ­¥ï¼šè·å–å¸ƒå±€View
    rootView = View.inflate(getActivity(), R.layout.fragment_a_content, null);
    //ç¬¬äºŒæ­¥ï¼šæ³¨å†Œå¸ƒå±€View
    LoadService loadService = LoadSir.getDefault().register(rootView, new Callback.OnReloadListener() {
        @Override
        public void onReload(View v) {
            // é‡æ–°åŠ è½½é€»è¾‘
        }
    });
    //ç¬¬ä¸‰æ­¥ï¼šè¿”å›LoadSirç”Ÿæˆçš„LoadLayout
    return loadService.getLoadLayout();
}
```

### ç¬¬ä¸‰æ­¥ï¼š å›è°ƒ

###### ç›´æ¥å›è°ƒ
```java
protected void loadNet() {
        // è¿›è¡Œç½‘ç»œè®¿é—®...
        // è¿›è¡Œå›è°ƒ
        loadService.showSuccess();//æˆåŠŸå›è°ƒ
        loadService.showCallback(EmptyCallback.class);//å…¶ä»–å›è°ƒ
    }
```
###### è½¬æ¢å™¨å›è°ƒ (æ¨èä½¿ç”¨)
å¦‚æœä½ ä¸æƒ³å†æ¯æ¬¡å›è°ƒéƒ½è¦æ‰‹åŠ¨è¿›è¡Œçš„è¯ï¼Œå¯ä»¥é€‰æ‹©æ³¨å†Œçš„æ—¶å€™åŠ å…¥è½¬æ¢å™¨ï¼Œå¯æ ¹æ®è¿”å›çš„æ•°æ®ï¼Œé€‚é…å¯¹åº”çš„çŠ¶æ€é¡µã€‚

```java
LoadService loadService = LoadSir.getDefault().register(this, new Callback.OnReloadListener() {
    @Override
    public void onReload(View v) {
            // é‡æ–°åŠ è½½é€»è¾‘
    }}, new Convertor<HttpResult>() {
    @Override
    public Class<? extends Callback> map(HttpResult httpResult) {
        Class<? extends Callback> resultCode = SuccessCallback.class;
        switch (httpResult.getResultCode()) {
            case SUCCESS_CODE://æˆåŠŸå›è°ƒ
                if (httpResult.getData().size() == 0) {
                    resultCode = EmptyCallback.class;
                }else{
                    resultCode = SuccessCallback.class;
                }
                break;
            case ERROR_CODE:
                resultCode = ErrorCallback.class;
                break;
        }
        return resultCode;
    }
});
```
å›è°ƒçš„æ—¶å€™ç›´æ¥ä¼ å…¥è½¬æ¢å™¨æŒ‡å®šçš„æ•°æ®ç±»å‹ã€‚
```java
loadService.showWithConvertor(httpResult);
```

### è‡ªå®šä¹‰å›è°ƒé¡µ
LoadSirä¸ºäº†å®Œå…¨è§£è€¦ï¼Œæ²¡æœ‰é¢„è®¾ä»»ä½•çŠ¶æ€é¡µï¼Œéœ€è¦è‡ªå·±å®ç°ï¼Œå¼€å‘è€…è‡ªå®šä¹‰è‡ªå·±çš„å›è°ƒé¡µé¢ï¼Œæ¯”å¦‚åŠ è½½ä¸­ï¼Œæ²¡æ•°æ®ï¼Œé”™è¯¯ï¼Œè¶…æ—¶ç­‰å¸¸ç”¨é¡µé¢ï¼Œ
è®¾ç½®å¸ƒå±€åŠè‡ªå®šä¹‰ç‚¹å‡»é€»è¾‘

```java
public class CustomCallback extends Callback {

    //å¡«å……å¸ƒå±€
    @Override
    protected int onCreateView() {
        return R.layout.layout_custom;
    }
    //å½“å‰Callbackçš„ç‚¹å‡»äº‹ä»¶ï¼Œå¦‚æœè¿”å›trueåˆ™è¦†ç›–æ³¨å†Œæ—¶çš„onReloa()ï¼Œå¦‚æœè¿”å›falseåˆ™ä¸¤è€…éƒ½æ‰§è¡Œï¼Œå…ˆæ‰§è¡ŒonReloadEvent()ã€‚
    @Override
    protected boolean onReloadEvent(final Context context, View view) {
        Toast.makeText(context.getApplicationContext(), "Hello buddy! :p", Toast.LENGTH_SHORT).show();
        (view.findViewById(R.id.iv_gift)).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Toast.makeText(context.getApplicationContext(), "It's your gift! :p", Toast.LENGTH_SHORT).show();
            }
        });
        return true;
    }

    //æ˜¯å¦åœ¨æ˜¾ç¤ºCallbackè§†å›¾çš„æ—¶å€™æ˜¾ç¤ºåŸå§‹å›¾(SuccessView)ï¼Œè¿”å›trueæ˜¾ç¤ºï¼Œfalseéšè—
    @Override
    public boolean getSuccessVisible() {
        return super.getSuccessVisible();
    }

    //å°†Callbackæ·»åŠ åˆ°å½“å‰è§†å›¾æ—¶çš„å›è°ƒï¼ŒViewä¸ºå½“å‰Callbackçš„å¸ƒå±€View
    @Override
    public void onAttach(Context context, View view) {
        super.onAttach(context, view);
    }

    //å°†Callbackä»å½“å‰è§†å›¾åˆ é™¤æ—¶çš„å›è°ƒï¼ŒViewä¸ºå½“å‰Callbackçš„å¸ƒå±€View
    @Override
    public void onDetach() {
        super.onDetach(context, view);
    }

}
```
### åŠ¨æ€ä¿®æ”¹Callback

```java
loadService = LoadSir.getDefault().register(...);
loadService.setCallBack(EmptyCallback.class, new Transport() {
   @Override
   public void order(Context context, View view) {
       TextView mTvEmpty = (TextView) view.findViewById(R.id.tv_empty);
       mTvEmpty.setText("fine, no data. You must fill it!");
   }
});
```

### LoadSirè‡ªå¸¦ä¾¿æºå¼Callback

```java
ProgressCallback loadingCallback = new ProgressCallback.Builder()
        .setTitle("Loading", R.style.Hint_Title)
        .build();

HintCallback hintCallback = new HintCallback.Builder()
        .setTitle("Error", R.style.Hint_Title)
        .setSubTitle("Sorry, buddy, I will try it again.")
        .setHintImg(R.drawable.error)
        .build();

LoadSir loadSir = new LoadSir.Builder()
        .addCallback(loadingCallback)
        .addCallback(hintCallback)
        .setDefaultCallback(ProgressCallback.class)
        .build();
```

åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°é—®é¢˜å¯ä»¥å…ˆå»[FAQ](docs/FAQ.md)å’ŒIssuesçœ‹çœ‹æœ‰æ²¡è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œè¯·ç»™æˆ‘æIssueå§ã€‚


### :bulb: About placeholder effect
placeholderæ•ˆæœçŠ¶æ€é¡µç±»ä¼¼[ShimmerRecyclerView](https://github.com/sharish/ShimmerRecyclerView)çš„æ•ˆæœ. LoadSiråªç”¨äº†ä¸€ä¸ª
è‡ªå®šä¹‰çŠ¶æ€é¡µPlaceHolderCallbackå°±å®Œæˆç±»ä¼¼çš„æ•ˆæœï¼Œæ˜¯ä¸æ˜¯å¾ˆæ£’ :ghost:

## Docs
* :point_right: [å¸¸è§é—®é¢˜](docs/FAQ-cn.md)
* ğŸ“Œ [æ›´æ–°æ—¥å¿—](docs/changelog.md)
* [æœ€ä½³å®è·µ](docs/BestPractice-cn.md)
* [ä¸‹ä¸ªç‰ˆæœ¬å¼€å‘è®¡åˆ’](docs/NextVersion.md)

## ä»£ç æ··æ·†

```xml
-dontwarn com.kingja.loadsir.**
-keep class com.kingja.loadsir.** {*;}
```

## Contact Me
Any questions,Welcome to contact me.
* Email:kingjavip@gmail.com
* QQç¾¤(818251143)

## License

    Copyright 2017 KingJA

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
